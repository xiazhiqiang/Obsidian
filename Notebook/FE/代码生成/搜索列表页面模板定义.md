
搜索列表页面框架使用 `@alibsp/form-list` 组件，由以下几个区域组成：
- 筛选区：通过特定条件对业务数据进行筛选过滤
  - 筛选项通过 ListPlus 组件属性 filter.items 设置
- 操作区：对业务数据进行增删改查
  - 操作项通过 ListPlus 组件属性 actions 设置
- 表格内容区：提供业务数据的可视化表达，方便用户快速查看。
  - 列表每列内容通过  ListPlus 组件属性 columns 设置   
- 分页器：操作表格的翻页、跳页
  - ListPlus 组件内置，默认情况下不需要额外设置

现在假设页面名称为：TestPage，基于此页面名称的模板代码规则如下，其中：

- src/pages/TestPage/index.jsx
  - 主入口文件
  - 要求：
    - id 和 className 属性根据给定的页面名称生成，其他模板代码中的属性不要修改。
    - 不要在主文件中实现操作功能，尽可能组件化。
    - @alife/xiaoer-list-plus 组件用法见类型定义，其中 filter、actions、 columns 属性需要根据需求文档和接口定义文档内容进行填充。
      - 关于 filter 属性要求：
      - 没有筛选项时 filter 属性设置为 {{}}
      - filter属性中 inline 必须设置为 true
      - 没有操作项时不需要设置 actions 属性
      - columns 中每个列表项的实现多于 2 行代码时必须组件化，少于2 行的不需要组件化。
      - 筛选项中的下拉选择框数据源，根据需求内容和接口定义生成，或使用常量定义，或通过接口请求获取。 

- src/pages/TestPage/components/Column1.tsx
  - 列信息展示：展示列表中每一列内容，使用列名作为组件名称，替代 Column1 
  - 例如：商品信息列，对应文件  src/pages/TestPage/components/ItemInfo.tsx 
  - 要求：
    - 根据需求文档、接口定义文档生成对应的组件代码。  
    - 使用 @ali/bybt-design 组件库中的组件实现，具体使用方法见类型定义和模板代码。  
        
- src/pages/TestPage/components/Action1.tsx
  - 整体操作，例如新增、批量同意、批量拒绝、批量上传、批量导入、一键导出等功能
  - 例如：批量导入操作，对应文件 src/pages/TestPage/components/BatchUploadAction.tsx
  - 要求：
    - 使用具体操作名称作为组件名称，以 Action 结尾，替代 Action1。例如 “批量同意”的组件名为 BatchAgreeAction 
    - 对于修改数据的功能需要将 reload 方法传入组件，在修改数据成功后，调用 reload 方法刷新页面数据。
    - 整体操作中的上传功能使用 @ali/bybt-design 中的 ExcelUploader 组件，具体使用方法见类型定义和模板代码，表单中的上传操作请使用 Fusion 组件库中的 Upload 实现上传功能。
            
- src/pages/TestPage/components/RecordAction1.tsx
  - 列表项操作，针对每条列表数据的操作，例如 同意、拒绝、编辑、查看详情等。 
  - 例如：删除操作，对应文件  src/pages/TestPage/components/RecordDeleteAction.tsx
  - 要求：
    - 使用具体操作名称作为组件名称，以 Action 结尾，替代 RecordAction1。例如 编辑 的组件名为 RecordUpdateAction。
    - 对于修改数据的功能需要将 reload 方法传入组件，在修改数据成功后，调用 reload 方法刷新页面数据。

- src/services/testPage.ts
  - 接口定义文件，基于模板代码，生成接口定义，替换掉原有的模板中的接口定义。注意接口路径都是 bzb.api 开头。 
  - 要求
    - 接口名称根据接口路径命名，
      - 查询接口名称以 get、query 开头，GET 方法
      - 创建接口名称以 create 开头，POST 方法  
      - 修改接口名称以 modify 开头，POST 方法
      - 删除接口名称以 delete 开头，POST 方法  
      - 例如 接口路径为：bzb.api.mp.api.price.pool.option，则接口名称为 queryPricePoolOption、getPricePoolOption。    
    - POST 接口使用 responseError 反馈错误信息，GET 接口使用  responseMessageError 反馈错误信息。

- src/mocks/testPage.ts
  - mock 数据文件
  - 要求：
    - 基于接口定义文档，生成 mock 数据，生成格式参照 mock 文件模板代码  
    - 如果是列表数据，请根据不同数据状态，mock 出多条不同状态下的数据

- 其他规则限制
  - 表单的实现  
    - 使用 @alifd/next 组件库的表单组件，表单数据管理使用 @alifd/next 组件库中的 Field。具体见表单实现代码模板。
    - 注意使用 @alifd/next 的 Field 组件时， 是 Field.useField() ,  不是  Form.useField()      
  - 组件的使用
    - 信息展示使用 @ali/bybt-design 组件库，用法见 @ali/bybt-design 组件库类型定义， 原则如下：
      - 有图片信息的使用 InfoCard  组件
      - 无图片信息的使用 Descriptions 组件，数字类型直接用 numeric 属性，不需要使用 NumberDisplay  
      - 只需要展示时间信息使用 DateDisplay 组件
      - 只需要展示数字信息使用 NumberDisplay 组件
      - 状态信息使用 @ali/bybt-design 中的 BizTag 组件  或 ColorTag 组件    
      - 按钮、弹窗、抽屉、消息提示等基础组件，只能使用 @alifd/next 组件库和 antd 组件库
      - 时间处理使用 moment 包     
    - 代码规范
      - 变量解构后再使用
      - 尽可能组件化使每个文件负责独立功能   
    - 文件命名
      - 生成代码时，将此模板中文件名 TestPage 替换为用户指定的文件名。

## src/pages/TestPage/index. jsx 文件模板代码

```javascript
import React, { useState } from "react";
import { Button } from "@alifd/next";
import FormList from "@alibsp/form-list";
import { PageCard } from "@alibsp/card";
import request from "@/service/base";
import { getListData } from "@/services/testPage";
import styles from "./index.module.scss";

// todo 表格列表数据接口
import { queryFormListGet } from "../../services/list";

// 自定义筛选项
import CustomFilter1 from "./components/CustomFilter1";
import CustomFilter2 from "./components/CustomFileter2";

// 自定义表格列
import CustomColumn1 from "./components/CustomColumn1";
import CustomColumn2 from "./components/CustomColumn2";

// 表格的操作列中，自定义操作项
import CustomAction1 from "./components/CustomAction1";
import CustomAction2 from "./components/CustomAction2";

// 注册自定义筛选组件
const filterCompsMap = {
  CustomFilter1,
  CustomFilter2,
  // 补充其他自定义筛选组件
};

// 注册自定义表格列组件
const tableColumnsMap = {
  CustomColumn1,
  CustomColumn2,
  // 补充其他自定义表格列组件
};

// 注册表格操作列中的自定义操作项
const tableActionsMap = {
  CustomAction1,
  CustomAction2,
};

function TestPage(props) {
  const [formListKey, setFormListKey] = useState(0); // 主动触发请求数据更新渲染

  // 筛选项定义
  const filterItems = [
    {
      label: `筛选1：`,
      key: "filter1", // 筛选字段名
      type: "CustomFilter1", // 关联已注册的自定义筛选组件名
      placeholder: "请输入", // 如果是类输入信息，则为请输入；其他类型则为请选择
      hasClear: true,
      trim: true,
    },
    {
      label: `筛选2：`,
      key: "filter2", // 筛选字段名
      type: "CustomFilter2", // 关联已注册的自定义筛选组件名
      placeholder: "请输选择", // 如果是类输入信息，则为请输入；其他类型则为请选择
      hasClear: true,
      trim: true,
      followTrigger: true, // 含有下拉选项的自定义组件，需要设置该属性
      showSearch: true, // 含有下拉选项的自定义组件，需要设置该属性
    },
    // 补充其他筛选项
  ];

  // 表格列定义
  const tableColumns = [
    {
      title: "列1",
      dataIndex: "column1", // 列数据字段
      width: 200, // 列宽
      type: "CustomColumn1", // 关联已注册的自定义列组件名
    },
    {
      title: "列2",
      dataIndex: "column2", // 列数据字段
      type: "CustomColumn2", // 关联已注册的自定义列组件名
      width: 150, // 列宽
    },
    {
      title: "列3",
      dataIndex: "column3",
    },
    // 补充其他列...

    {
      title: "操作",
      dataIndex: "actions", // 表格操作列指定`actions`字段
      width: 260,
      type: "Actions",
      lock: "right",
    },
  ];

  // 表格定义
  const tableActions = [
    {
      type: "CustomAction1", // 关联已注册的表格操作列，自定义操作项组件名
      text: "操作1",
    },
    {
      type: "CustomAction2", // 关联已注册的表格操作列，自定义操作项组件名
      text: "操作2",
    },
  ];

  // 自定义列表上方操作区渲染
  const customActionBarRender = ({ refresh }) => {
    return (
      <div>
        <Button
          type="primary"
          onClick={() => {
            // 操作行为

            // 触发请求数据更新渲染
            refresh();
          }}
        >
          + 新增
        </Button>
      </div>
    );
  };

  const getListData = async ({ current, pageSize }, formData = {}) => {
    const res = await getListData({ current, pageSize, ...formData });
    if (res.success && res?.data?.list?.length > 0) {
      return {
        ...res.data,
        list: res.data.list.map((item) => {
          return { ...item, actions: tableActions };
        }),
      };
    } else {
      return { list: [], total: 0 };
    }
  };

  // 触发列表重新请求渲染
  const updateFormList = () => {
    setFormListKey(Math.round(10000 * Math.random()));
  };

  return (
    <div className={styles["table-form"]}>
      <PageCard>
        <FormList
          customActionBarRender={customActionBarRender} // 自定义列表上方操作区渲染
          filterCompsMap={filterCompsMap} // 注册自定义筛选组件
          tableColumnsMap={tableColumnsMap} // 注册自定义表格列组件
          tableActionsMap={tableActionsMap} // 注册表格列中自定义操作项
          key={formListKey}
          fetchData={getListData} // 请求数据
          schema={{
            tableSchema: { props: { columns: tableColumns } }, // 注册表格列定义
            filterSchema: { props: { dataSource: filterItems } }, // 注册筛选项定义
          }}
          // 表格区域扩展参数配置
          tableShuttle={{
            hasBorder: false, // 表格无边框
            maxActionLength: 6, // 操作列内部最多显示几个按钮后，以'更多'显示收起
          }}
          // 筛选区域扩展参数配置
          filterProps={{
            defaultExpended: true, // 搜索项多行时，默认展开
            col: 4, // 搜索项一行几列
            shuttleProps: {},
          }}
          // 分页器扩展参数配置
          paginationProps={{
            hideOnlyOnePage: true, // 数据不超过一页时隐藏分页器
          }}
        />
      </PageCard>
    </div>
  );
}

export default TestPage;

```

## src/pages/TestPage/index. module.scss 文件模板代码

```scss
.table-form {
  // 不需要自动补充样式代码
}
```

## src/pages/TestPage/components/Column1/index.jsx 文件模板代码

此模板演示套件类型信息展示

```javascript
import React from 'react';
import { Icon } from '@alifd/next';

const componentTypeList = [
  {
    typeCode: 'componentType',
    typeName: 'AI套件类型',
    key: 'inference',
    value: '推理',
  },
  {
    typeCode: 'componentType',
    typeName: 'AI套件类型',
    key: 'train',
    value: '训练',
  },
  {
    typeCode: 'componentType',
    typeName: 'AI套件类型',
    key: 'quant',
    value: '量化',
  },
];

export default function CustomComponentTags(props) {
  const { value = [], record } = props || {};

  if (!value || !Array.isArray(value)) {
    return null;
  }

  return (value || []).map((i, idx) => {
    const v = ((componentTypeList || []).find((m) => m?.key === i) || {})?.value || '';

    return v ? (
      <span data-component-type={i} style={{ marginRight: '2px', display: 'inline-block' }}>
        <Icon type="select" style={{ color: '#179a09' }} size="small" />
        {v}
      </span>
    ) : null;
  });
}


```

## src/pages/TestPage/components/Column2/index.jsx 文件模板代码

此模板演示主副标题信息展示

```javascript
import React from 'react';
import styles from './index.module.scss';

export default function CustomColumn2(props) {
  const { record = {} } = props || {};

  return (
    <div className={styles['titleWithSub']}>
      <div className={styles['name']}>{record?.name}</div>
      <div title={record?.code}>{record?.code}</div>
    </div>
  );
}
```

## src/pages/TestPage/components/Column2/index. module. scss 文件模板代码

```scss
.titleWithSub {
  // 不需要自动补充样式
}
```

## src/pages/TestPage/components/Action1/index.jsx 文件模板代码

此模板演示点击表格操作项时跳转到其他页面的代码示例

```javascript
import React from "react";
import { Button } from "@alifd/next";

export default function CustomAction1(props) {
  const { refresh, text } = props || {};
  return (
    <Button
      type="primary"
      text
      style={{ marginRight: 8 }}
      onClick={() => {
        // 这里写点击操作项的事件行为
        location.href = '#/xxx/yyy';
      }}
    >
      {text}
    </Button>
  );
}

```

## src/pages/TestPage/components/Action2/index.jsx 文件模板代码

此模板演示点击操作项打开弹窗展示表单内容，确认后调用编辑更新接口代码示例

```javascript
import React, { useState } from "react";
import { Button, Dialog, Select, Field, Form } from "@alifd/next";
import { editListItem } from "@/services/testPage";

export default function CustomAction2(props) {
  const { refresh, text, record = {} } = props || {};
  const [visible, setVisible] = useState(false);
  const field = Field.useField(); // 注意这里是 Field.useField， 不是 Form.useField()

  const onDialogClose = () => setVisible(false);

  return (
    <>
      <Button
        type="primary"
        text
        style={{ marginRight: 8 }}
        onClick={() => {
          setVisible(true);
          field.setValues(record || {});
        }}
      >
        {text}
      </Button>
      <Dialog
      	width={600}
        visible={visible}
        title="编辑xxx"
        onOk={async () => {
          const { errors, values = {} } = await field.validatePromise();
          if (!errors) {
            return;
          }

          // 请求接口
          const res = await editListItem(values || {});
          if (res?.sucess) {
            onDialogClose();
            refresh();
          }
        }}
        onClose={onDialogClose}
        onCancel={onDialogClose}
      >
        <Form field={field} labelCol={{ span: 4 }}>
          <Form.Item label="输入项1" name="index1" required>
            <Input trim placeholder="请输入" style={{ width: "100%" }} />
          </Form.Item>
          <Form.Item label="选择项2" name="index2" required>
            <Select
              placeholder="请选择"
              onChange={(v) => setSelectData(v)}
              style={{ width: "100%" }}
              dataSource={[
                { label: "选项1", value: "v1" },
                { label: "选项2", value: "v2" },
              ]}
            />
          </Form.Item>
        </Form>
      </Dialog>
    </>
  );
}

```

点击新建/编辑操作后，打开弹窗或抽屉后展示表单内容和操作的代码示例

```tsx
import { Button, Dialog, Form, Message, Field, NumberPicker, Input } from '@alifd/next';
import { createTestPageData, modifyTestPageData } from '@/services/testPage';

interface IProps {
  record: ITestPageData;
  reload: VoidFunction;
}

export default function UpdateAction(props: IProps) {
  const [visible, setVisible] = useState(false);
  const field = Field.useField(); // 注意这里是 Field.useField， 不是 Form.useField()

  const handleSubmit = async () => {
    const { errors, values = {} } = await field.validatePromise();

    if (errors) {
      Message.warning('请完善必填项');
      return;
    }

    const { index1, index2 } = values as any;

    if (record?.id) {
      const modifyParams = {
        ...params,
        id: record.id,
      };
      const res = await modifyTestPageData(modifyParams);

      if (res.success) {
        Message.success('修改成功！');
        setVisible(false);
        reload?.();
      }
    } else {
      const res = await createTestPageData({
        periodId,
        totalAmount,
        totalSpentAmount,
      });

      if (res.success) {
        Message.success('创建成功！');
        setVisible(false);
        reload?.();
      }
    }
  }

  const handleClick = () => setVisible(true);

  return (
    <>
      <Button type="primary" text onClick={handleClick} style={{ marginRight: 10 }}>
        {record.id ? '编辑' : '新建'}
      </Button>
      {/* 操作按钮与打开的弹窗/抽屉封装在同一组件中 */}
      <Dialog
        v2
        width={600}
        centered
        title={record.id ? '编辑' : '新建'}
        visible={visible}
        onOk={handleSubmit}
        onClose={() => {
          setVisible(false);
        }}
      >
        <Form colon field={field} useLabelForErrorMessage labelCol={{ span: 4 }}>
          <Form.Item label="输入项1" name="index1" required>
            <Input style={{ width: 300 }} />
          </Form.Item>
          <Form.Item label="输入项2" name="index2" required>
            <NumberPicker precision={2} min={0} style={{ width: 300 }} />
          </Form.Item>
        </Form>
      </Dialog>
    </>
  );
}
```

## src/services/testPage. js 文件模板代码

```javascript
import request from "./base";

// 获取列表信息
export async function getListData(params) {
  return request({
    url: "/api/xxxx/list",
    params,
    method: "get",
  });
}

// 创建列表信息
export async function createListData(data) {
  return request({
    url: "/api/yyyy/create",
    data,
    method: "post",
  });
}

// 编辑列表项信息
export async function editListItem(data) {
  return request({
    url: "/api/zzzz/edit",
    data,
    method: "post",
  });
}

```

## @alibsp/form-list 组件定义

这是一个列表组件，包含筛选区、操作区、表格区，分页器以及整体布局。
使用限制：
- 若没有筛选项时，filterItems=[]，filterCompsMap={}

引入方式示例：

```tsx
import FormList from '@alibsp/form-list';
```

FormList 组件的 Props 类型定义如下：

```typescript
interface IFormListProps {
  /**
   * 更新标识符
   */
  key?: string;

  /**
   * 自定义列表上方操作区渲染
   */
  customActionBarRender?: (refresh: () => void) => React.ComponentType<any>;

  /**
   * 注册自定义筛选组件
   */
  filterCompsMap?: {
    [k: string]: React.ComponentType<any>;
  };

  /**
   * 注册自定义表格列组件
   */
  tableColumnsMap?: { [k: string]: React.ComponentType<any> };

  /**
   * 注册表格列中自定义操作项
   */
  tableActionsMap?: { [k: string]: React.ComponentType<any> };

  /**
   * 请求数据
   */
  fetchData: (
    p: {
      current: number;
      pageSize: number;
    },
    /**
    * 筛选项选择的键值对组成的对象
    */
    formData?: { [k: string]: any },
  ) => Promise<{
    list: Array<any>;
    
    /**
    * 总条数
    */
    total: number;
    
    /**
    * 说明当前页码
    */
    current: number;
    
    /**
    * 每页条数
    */
    pageSize: number;
  }>;

  /**
   * 注册表格列定义
   */
  schema: {
    tableSchema: {
      props: {
        columns: Array<{
          /**
           * 列标题
           */
          title: string;

          /**
           * 列数据字段
           */
          dataIndex: string;

          /**
           * 列宽
           */
          width: number | string;

          /**
           * 关联已注册的自定义列组件名
           */
          type?: string;

          /**
           * 锁定列，左侧锁定'left'或右侧锁定'right'
           */
          lock?: string | "left" | "right";

          [k: string]: any;
        }>;
      };
    };

    /**
     * 注册筛选项定义
     */
    filterSchema?: {
      props: {
        dataSource: Array<{
          /**
           * 筛选项标题
           */
          label: string;

          /**
           * 筛选字段名
           */
          key: string;

          /**
           * 关联已注册的自定义筛选组件名
           */
          type: string;

          /**
           * 如果是类输入信息，则为请输入；其他类型则为请选择
           */
          placeholder?: string;

          /**
           * 是否一键清除
           */
          hasClear?: boolean;

          /**
           * 输入类型，需要去除前后字符串空白字符
           */
          trim?: boolean | true;

          /**
           * 含有下拉选项的自定义组件，需要设置该属性
           */
          followTrigger?: boolean | true;

          /**
           * 含有下拉选项的自定义组件，需要设置该属性
           */
          showSearch?: boolean | true;

          /**
           * 受控默认值
           */
          value?: any;

          [k: string]: any;
        }>;
      };
    };
  };

  /**
   * 表格区域扩展参数配置
   */
  tableShuttle?: {
    /**
     * 表格无边框
     */
    hasBorder?: boolean;

    /**
     * 操作列内部最多显示几个按钮后，以'更多'显示收起
     */
    maxActionLength?: number;

    [k: string]: any;
  };

  /**
   * 筛选区域扩展参数配置
   */
  filterProps?: {
    /**
     * 搜索项多行时，默认展开
     */
    defaultExpended?: boolean;

    /**
     * 搜索项一行几列
     */
    col?: number;

    /**
     * shuttle组件参数
     */
    shuttleProps?: any | {};

    [k: string]: any;
  };

  /**
   * 分页器扩展参数配置
   */
  paginationProps?: {
    /**
     * 数据不超过一页时隐藏分页器
     */
    hideOnlyOnePage: boolean;

    [k: string]: any;
  };

  /**
   * 其他可能的属性
   */
  [key: string]: any;
}


```
